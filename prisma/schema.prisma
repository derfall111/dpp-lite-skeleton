generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Product {
  id          String     @id @default(cuid())
  publicId    String     @unique
  sku         String
  gtin        String?
  name        String
  category    String?
  description String?
  createdAt   DateTime   @default(now())
  evidences   Evidence[]
}

model Evidence {
  id         String     @id @default(cuid())
  product    Product?   @relation(fields: [productId], references: [id])
  productId  String?
  issuer     String?
  filename   String
  mimeType   String
  byteSize   Int
  sha256Hex  String     @unique
  storageUrl String
  createdAt  DateTime   @default(now())
  anchoring  Anchoring?

  @@index([sha256Hex])
}

model Anchoring {
  id          String   @id @default(cuid())
  evidence    Evidence @relation(fields: [evidenceId], references: [id])
  evidenceId  String   @unique
  chain       String
  network     String
  txHash      String
  blockNumber Int?
  anchoredAt  DateTime
  merkleRoot  String?
  method      String?
}
